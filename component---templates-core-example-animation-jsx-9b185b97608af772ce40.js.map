{"version":3,"sources":["webpack:///../modules/core/src/scenegraph/nodes/model-node.js","webpack:///../modules/addons/src/animation/key-frames.js","webpack:///../examples/core/animation/app.js","webpack:///./templates/core/example-animation.jsx","webpack:///../modules/shadertools/src/modules/project/project.js","webpack:///../modules/shadertools/src/modules/dirlight/dirlight.js","webpack:///../modules/core/src/scenegraph/nodes/scenegraph-node.js","webpack:///../modules/core/src/geometries/cube-geometry.js","webpack:///../node_modules/math.gl/dist/esm/classes/base/vector.js","webpack:///../node_modules/math.gl/dist/esm/classes/vector3.js","webpack:///../modules/addons/src/animation/timeline.js"],"names":["ModelNode","props","gl","setProps","this","_setModelNodeProps","delete","model","managedResources","forEach","resource","draw","setUniforms","setAttributes","updateModuleSettings","ScenegraphNode","KeyFrames","_lastTime","startIndex","endIndex","factor","times","values","setKeyFrames","keyFrames","setTime","numKeys","length","i","_calculateKeys","time","Math","getStartTime","getEndTime","getStartData","getEndData","index","startTime","endTime","AppAnimationLoop","debug","getInfo","onInitialize","aspect","_animationLoop","setParameters","clearColor","clearDepth","depthTest","depthFunc","LEQUAL","playButton","document","pauseButton","timeSlider","event","parseFloat","translations","rotations","colors","attachTimeline","timeline","play","channels","addChannel","delay","rate","duration","repeat","Number","POSITIVE_INFINITY","keyFrameData","cubes","Array","attachAnimation","translation","rotation","vs","fs","modules","geometry","uniforms","uProjection","fov","radians","near","far","uView","center","eye","uColor","onRender","animationProps","modelMatrix","cube","startRotation","endRotation","rotationX","rotationY","rotationZ","uModel","onFinalize","AnimationLoop","window","animationLoop","Example","render","exampleConfig","pageContext","React","Component","IDENTITY_MATRIX","DEFAULT_MODULE_OPTIONS","viewMatrix","projectionMatrix","cameraPositionWorld","name","getUniforms","opts","prevUniforms","common","lightDirection","Float32Array","dependencies","project","id","uid","constructor","display","position","scale","matrix","userData","_setScenegraphNodeProps","toString","setPosition","assert","setRotation","setScale","setMatrix","copyMatrix","copy","setMatrixComponents","update","updateMatrix","pos","rot","identity","translate","rotateXYZ","getCoordinateUniforms","worldMatrix","worldInverse","worldInverseTranspose","objectMatrix","worldInverseMatrix","worldInverseTransposeMatrix","Object","CUBE_INDICES","Uint16Array","CUBE_POSITIONS","CUBE_NORMALS","CUBE_TEX_COORDS","ATTRIBUTES","POSITION","size","value","NORMAL","TEXCOORD_0","CubeGeometry","indices","attributes","Geometry","_MathArray","Vector","apply","arguments","key","sqrt","lengthSquared","len","ELEMENTS","mathArray","distanceSquared","dist","product","magnitude","check","_len","vectors","_key","_i","_vectors","vector","_len2","_key2","_i2","_vectors2","distance","a","b","add","subtract","multiply","multiplyScalar","get","set","ORIGIN","_Vector","Vector3","_this","x","undefined","y","z","call","array","object","vec3","_ref","_ref$origin","origin","_ref2","_ref2$origin","_ref3","_ref3$origin","matrix4","transformAsPoint","matrix3","matrix2","quaternion","channelHandles","animationHandles","Timeline","animations","playing","lastEngineTime","handle","channel","_setChannelTime","removeChannel","animationHandle","animation","detachAnimation","isFinished","getTime","animationData","pause","reset","channelHandle","engineTime","offsetTime"],"mappings":"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","file":"component---templates-core-example-animation-jsx-9b185b97608af772ce40.js","sourcesContent":["import Model from '../../lib/model';\nimport ScenegraphNode from './scenegraph-node';\n\nexport default class ModelNode extends ScenegraphNode {\n  constructor(gl, props = {}) {\n    super(props);\n\n    // pverride callbacks to make sure we call them with this\n    this.onBeforeRender = null;\n    this.AfterRender = null;\n\n    // Create new Model or used supplied Model\n    if (gl instanceof Model) {\n      this.model = gl;\n      this._setModelNodeProps(props);\n    } else {\n      this.model = new Model(gl, props);\n    }\n\n    this.managedResources = props.managedResources || [];\n  }\n\n  setProps(props) {\n    super.setProps(props);\n    this._setModelNodeProps(props);\n    return this;\n  }\n\n  delete() {\n    if (this.model) {\n      this.model.delete();\n      this.model = null;\n    }\n\n    this.managedResources.forEach(resource => resource.delete());\n    this.managedResources = [];\n  }\n\n  // Forward node methods\n  draw(...args) {\n    // Return value indicates if something was actually drawn\n    return this.model.draw(...args);\n  }\n\n  setUniforms(...args) {\n    this.model.setUniforms(...args);\n    return this;\n  }\n\n  setAttributes(...args) {\n    this.model.setAttributes(...args);\n    return this;\n  }\n\n  updateModuleSettings(...args) {\n    this.model.updateModuleSettings(...args);\n    return this;\n  }\n\n  // PRIVATE\n\n  _setModelNodeProps(props) {\n    this.model.setProps(props);\n  }\n}\n","export class KeyFrames {\n  constructor(keyFrames) {\n    this._lastTime = -1;\n    this.startIndex = -1;\n    this.endIndex = -1;\n    this.factor = 0;\n    this.times = [];\n    this.values = [];\n    this.setKeyFrames(keyFrames);\n    this.setTime(0);\n  }\n\n  setKeyFrames(keyFrames) {\n    const numKeys = keyFrames.length;\n    this.times.length = numKeys;\n    this.values.length = numKeys;\n\n    for (let i = 0; i < numKeys; ++i) {\n      this.times[i] = keyFrames[i][0];\n      this.values[i] = keyFrames[i][1];\n    }\n\n    this._calculateKeys(this._lastTime);\n  }\n\n  setTime(time) {\n    time = Math.max(0, time);\n\n    if (time !== this._lastTime) {\n      this._calculateKeys(time);\n      this._lastTime = time;\n    }\n  }\n\n  getStartTime() {\n    return this.times[this.startIndex];\n  }\n\n  getEndTime() {\n    return this.times[this.endIndex];\n  }\n\n  getStartData() {\n    return this.values[this.startIndex];\n  }\n\n  getEndData() {\n    return this.values[this.endIndex];\n  }\n\n  _calculateKeys(time) {\n    let index = 0;\n    const numKeys = this.times.length;\n\n    for (index = 0; index < numKeys - 2; ++index) {\n      if (this.times[index + 1] > time) {\n        break;\n      }\n    }\n\n    this.startIndex = index;\n    this.endIndex = index + 1;\n\n    const startTime = this.times[this.startIndex];\n    const endTime = this.times[this.endIndex];\n    this.factor = Math.min(Math.max(0, (time - startTime) / (endTime - startTime)), 1);\n  }\n}\n","/* global document */\n\nimport {AnimationLoop, setParameters, ModelNode, dirlight, CubeGeometry} from '@luma.gl/core';\nimport {Timeline, KeyFrames} from '@luma.gl/addons';\nimport {Matrix4, radians} from 'math.gl';\n\nconst INFO_HTML = `\nKey frame animation based on multiple hierarchical timelines.\n<button id=\"play\">Play</button>\n<button id=\"pause\">Pause</button><BR>\nTime: <input type=\"range\" id=\"time\" min=\"0\" max=\"30000\" step=\"1\"><BR>\n`;\n\nconst vs = `\\\nattribute vec3 positions;\nattribute vec3 normals;\n\nuniform vec3 uColor;\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nvarying vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(uModel * vec4(normals, 0.0));\n\n  // Set up data for modules\n  color = uColor;\n  project_setNormal(normal);\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n}\n`;\n\nconst fs = `\\\nprecision highp float;\n\nvarying vec3 color;\n\nvoid main(void) {\n  gl_FragColor = vec4(color, 1.);\n  gl_FragColor = dirlight_filterColor(gl_FragColor);\n}\n`;\n\nexport default class AppAnimationLoop extends AnimationLoop {\n  constructor() {\n    super({debug: true});\n  }\n\n  static getInfo() {\n    return INFO_HTML;\n  }\n\n  onInitialize({gl, _animationLoop, aspect}) {\n    setParameters(gl, {\n      clearColor: [0, 0, 0, 1],\n      clearDepth: 1,\n      depthTest: true,\n      depthFunc: gl.LEQUAL\n    });\n\n    const playButton = document.getElementById('play');\n    const pauseButton = document.getElementById('pause');\n    const timeSlider = document.getElementById('time');\n\n    if (playButton) {\n      playButton.addEventListener('click', () => {\n        this.timeline.play();\n      });\n\n      pauseButton.addEventListener('click', () => {\n        this.timeline.pause();\n      });\n\n      timeSlider.addEventListener('input', event => {\n        this.timeline.setTime(parseFloat(event.target.value));\n      });\n    }\n\n    const translations = [[2, -2, 0], [2, 2, 0], [-2, 2, 0], [-2, -2, 0]];\n\n    const rotations = [\n      [Math.random(), Math.random(), Math.random()],\n      [Math.random(), Math.random(), Math.random()],\n      [Math.random(), Math.random(), Math.random()],\n      [Math.random(), Math.random(), Math.random()]\n    ];\n\n    const colors = [[1, 0, 0], [0, 1, 0], [0, 0, 1], [1, 1, 0]];\n\n    this.attachTimeline(new Timeline());\n    this.timeline.play();\n\n    const channels = [\n      this.timeline.addChannel({\n        delay: 2000,\n        rate: 0.5,\n        duration: 8000,\n        repeat: 2\n      }),\n      this.timeline.addChannel({\n        delay: 10000,\n        rate: 0.2,\n        duration: 20000,\n        repeat: 1\n      }),\n      this.timeline.addChannel({\n        delay: 7000,\n        rate: 1,\n        duration: 4000,\n        repeat: 8\n      }),\n      this.timeline.addChannel({\n        delay: 0,\n        rate: 0.8,\n        duration: 5000,\n        repeat: Number.POSITIVE_INFINITY\n      })\n    ];\n\n    const keyFrameData = [\n      [0, 0],\n      [1000, 2 * Math.PI],\n      [2000, Math.PI],\n      [3000, 2 * Math.PI],\n      [4000, 0]\n    ];\n\n    const keyFrames = [\n      new KeyFrames(keyFrameData),\n      new KeyFrames(keyFrameData),\n      new KeyFrames(keyFrameData),\n      new KeyFrames(keyFrameData)\n    ];\n\n    this.cubes = new Array(4);\n\n    for (let i = 0; i < 4; ++i) {\n      this.timeline.attachAnimation(keyFrames[i], channels[i]);\n\n      this.cubes[i] = {\n        translation: translations[i],\n        rotation: rotations[i],\n        keyFrames: keyFrames[i],\n        model: new ModelNode(gl, {\n          vs,\n          fs,\n          modules: [dirlight],\n          geometry: new CubeGeometry(),\n          uniforms: {\n            uProjection: new Matrix4().perspective({fov: radians(60), aspect, near: 1, far: 20.0}),\n            uView: new Matrix4().lookAt({\n              center: [0, 0, 0],\n              eye: [0, 0, -8]\n            }),\n            uColor: colors[i]\n          }\n        })\n      };\n    }\n\n    return {timeSlider};\n  }\n\n  onRender(animationProps) {\n    const {gl, timeSlider} = animationProps;\n\n    if (timeSlider) {\n      timeSlider.value = this.timeline.getTime();\n    }\n\n    const modelMatrix = new Matrix4();\n\n    // Draw the cubes\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    for (let i = 0; i < 4; ++i) {\n      const cube = this.cubes[i];\n      const startRotation = cube.keyFrames.getStartData();\n      const endRotation = cube.keyFrames.getEndData();\n      const rotation = startRotation + cube.keyFrames.factor * (endRotation - startRotation);\n      const rotationX = cube.rotation[0] + rotation;\n      const rotationY = cube.rotation[1] + rotation;\n      const rotationZ = cube.rotation[2];\n      modelMatrix\n        .identity()\n        .translate(cube.translation)\n        .rotateXYZ([rotationX, rotationY, rotationZ]);\n      cube.model\n        .setUniforms({\n          uModel: modelMatrix\n        })\n        .draw();\n    }\n  }\n\n  onFinalize({gl}) {\n    for (let i = 0; i < 4; ++i) {\n      this.cubes[i].model.delete();\n    }\n  }\n}\n\n/* global window */\nif (typeof window !== 'undefined' && !window.website) {\n  const animationLoop = new AppAnimationLoop();\n  animationLoop.start();\n}\n","import React from 'react';\nimport AnimationLoopExamplePage from '../../src/components/animation-loop-example-page';\nimport AnimationLoop from '../../../examples/core/animation/app';\n\nexport default class Example extends React.Component {\n  render() {\n    return (\n      <AnimationLoopExamplePage AnimationLoop={AnimationLoop} exampleConfig={this.props.pageContext.exampleConfig} />\n    );\n  }\n}\n","import {Matrix4} from 'math.gl';\n\nconst IDENTITY_MATRIX = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n\nconst DEFAULT_MODULE_OPTIONS = {\n  modelMatrix: IDENTITY_MATRIX,\n  viewMatrix: IDENTITY_MATRIX,\n  projectionMatrix: IDENTITY_MATRIX,\n  cameraPositionWorld: [0, 0, 0]\n};\n\nfunction getUniforms(opts = DEFAULT_MODULE_OPTIONS, prevUniforms = {}) {\n  // const viewProjectionInverse = viewProjection.invert();\n  // viewInverseMatrix: view.invert(),\n  // viewProjectionInverseMatrix: viewProjectionInverse\n\n  const uniforms = {};\n  if (opts.modelMatrix !== undefined) {\n    uniforms.modelMatrix = opts.modelMatrix;\n  }\n  if (opts.viewMatrix !== undefined) {\n    uniforms.viewMatrix = opts.viewMatrix;\n  }\n  if (opts.projectionMatrix !== undefined) {\n    uniforms.projectionMatrix = opts.projectionMatrix;\n  }\n  if (opts.cameraPositionWorld !== undefined) {\n    uniforms.cameraPositionWorld = opts.cameraPositionWorld;\n  }\n\n  // COMPOSITE UNIFORMS\n  if (opts.projectionMatrix !== undefined || opts.viewMatrix !== undefined) {\n    uniforms.viewProjectionMatrix = new Matrix4(opts.projectionMatrix).multiplyRight(\n      opts.viewMatrix\n    );\n  }\n\n  return uniforms;\n}\n\nconst common = `\\\nvarying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n`;\n\nconst vs = `\\\n${common}\n\n// Unprefixed uniforms\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform vec3 cameraPositionWorld;\n\nstruct World {\n  vec3 position;\n  vec3 normal;\n};\n\nWorld world;\n\nvoid project_setPosition(vec4 position) {\n  project_vPositionWorld = position;\n}\n\nvoid project_setNormal(vec3 normal) {\n  project_vNormalWorld = normal;\n}\n\nvoid project_setPositionAndNormal_World(vec3 position, vec3 normal) {\n  world.position = position;\n  world.normal = normal;\n}\n\nvoid project_setPositionAndNormal_Model(vec3 position, vec3 normal) {\n  world.position = (modelMatrix * vec4(position, 1.)).xyz;\n  world.normal = mat3(modelMatrix) * normal;\n}\n\nvec4 project_model_to_clipspace(vec4 position) {\n  return viewProjectionMatrix * modelMatrix * position;\n}\n\nvec4 project_model_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);\n}\n\nvec4 project_world_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_view_to_clipspace(vec3 position) {\n  return projectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n`;\n\nconst fs = `\n${common}\\\n`;\n\nexport default {\n  name: 'project',\n  getUniforms,\n  vs,\n  fs\n};\n","// Cheap lighting - single directional light, single dot product, one uniform\n\nimport project from '../project/project';\n\n/* eslint-disable camelcase */\nconst DEFAULT_LIGHT_DIRECTION = new Float32Array([1, 1, 2]);\n\nconst DEFAULT_MODULE_OPTIONS = {\n  lightDirection: DEFAULT_LIGHT_DIRECTION\n};\n\nfunction getUniforms(opts = DEFAULT_MODULE_OPTIONS) {\n  const uniforms = {};\n  if (opts.lightDirection) {\n    uniforms.dirlight_uLightDirection = opts.lightDirection;\n  }\n  return uniforms;\n}\n\n// TODO - reuse normal from geometry module\nconst vs = null;\n\nconst fs = `\\\nuniform vec3 dirlight_uLightDirection;\n\n/*\n * Returns color attenuated by angle from light source\n */\nvec4 dirlight_filterColor(vec4 color) {\n  vec3 normal = project_getNormal_World();\n  float d = abs(dot(normalize(normal), normalize(dirlight_uLightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n`;\n\nexport default {\n  name: 'dirlight',\n  vs,\n  fs,\n  getUniforms,\n  dependencies: [project]\n};\n","import {Vector3, Matrix4} from 'math.gl';\nimport {assert, uid} from '../../utils';\n\nexport default class ScenegraphNode {\n  constructor(props = {}) {\n    const {id} = props;\n\n    this.id = id || uid(this.constructor.name);\n\n    this.display = true; // whether to display the object at all\n    this.position = new Vector3();\n    this.rotation = new Vector3();\n    this.scale = new Vector3(1, 1, 1);\n    this.matrix = new Matrix4();\n    this.userData = {};\n\n    this.props = {};\n    this._setScenegraphNodeProps(props);\n  }\n\n  delete() {}\n\n  setProps(props) {\n    this._setScenegraphNodeProps(props);\n    return this;\n  }\n\n  toString() {\n    return `{type: ScenegraphNode, id: ${this.id})}`;\n  }\n\n  setPosition(position) {\n    assert(position.length === 3, 'setPosition requires vector argument');\n    this.position = position;\n    return this;\n  }\n\n  setRotation(rotation) {\n    assert(rotation.length === 3, 'setRotation requires vector argument');\n    this.rotation = rotation;\n    return this;\n  }\n\n  setScale(scale) {\n    assert(scale.length === 3, 'setScale requires vector argument');\n    this.scale = scale;\n    return this;\n  }\n\n  setMatrix(matrix, copyMatrix = true) {\n    if (copyMatrix) {\n      this.matrix.copy(matrix);\n    } else {\n      this.matrix = matrix;\n    }\n  }\n\n  setMatrixComponents({position, rotation, scale, update = true}) {\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    if (update) {\n      this.updateMatrix();\n    }\n    return this;\n  }\n\n  updateMatrix() {\n    const pos = this.position;\n    const rot = this.rotation;\n    const scale = this.scale;\n\n    this.matrix.identity();\n    this.matrix.translate(pos);\n    this.matrix.rotateXYZ(rot);\n    this.matrix.scale(scale);\n    return this;\n  }\n\n  update({position, rotation, scale} = {}) {\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    this.updateMatrix();\n    return this;\n  }\n\n  getCoordinateUniforms(viewMatrix, modelMatrix) {\n    // TODO - solve multiple class problem\n    // assert(viewMatrix instanceof Matrix4);\n    assert(viewMatrix);\n    modelMatrix = modelMatrix || this.matrix;\n    const worldMatrix = new Matrix4(viewMatrix).multiplyRight(modelMatrix);\n    const worldInverse = worldMatrix.invert();\n    const worldInverseTranspose = worldInverse.transpose();\n\n    return {\n      viewMatrix,\n      modelMatrix,\n      objectMatrix: modelMatrix,\n      worldMatrix,\n      worldInverseMatrix: worldInverse,\n      worldInverseTransposeMatrix: worldInverseTranspose\n    };\n  }\n\n  // TODO - copied code, not yet vetted\n  /*\n  transform() {\n    if (!this.parent) {\n      this.endPosition.set(this.position);\n      this.endRotation.set(this.rotation);\n      this.endScale.set(this.scale);\n    } else {\n      const parent = this.parent;\n      this.endPosition.set(this.position.add(parent.endPosition));\n      this.endRotation.set(this.rotation.add(parent.endRotation));\n      this.endScale.set(this.scale.add(parent.endScale));\n    }\n\n    const ch = this.children;\n    for (let i = 0; i < ch.length; ++i) {\n      ch[i].transform();\n    }\n\n    return this;\n  }\n  */\n\n  _setScenegraphNodeProps(props) {\n    if ('display' in props) {\n      this.display = props.display;\n    }\n\n    if ('position' in props) {\n      this.setPosition(props.position);\n    }\n    if ('rotation' in props) {\n      this.setRotation(props.rotation);\n    }\n    if ('scale' in props) {\n      this.setScale(props.scale);\n    }\n\n    // Matrix overwrites other props\n    if ('matrix' in props) {\n      this.setMatrix(props.matrix);\n    }\n\n    Object.assign(this.props, props);\n  }\n}\n","import Geometry from '../geometry/geometry';\nimport {uid} from '../utils';\n\n// prettier-ignore\nconst CUBE_INDICES = new Uint16Array([\n  0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13,\n  14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23\n]);\n\n// prettier-ignore\nconst CUBE_POSITIONS = new Float32Array([\n  -1,  -1,  1, 1,  -1,  1,  1,  1,  1,  -1,  1,  1,\n  -1,  -1,  -1,  -1,  1,  -1,  1,  1,  -1,  1,  -1,  -1,\n  -1,  1,  -1,  -1,  1,  1,  1,  1,  1,  1,  1,  -1,\n  -1,  -1,  -1,  1,  -1,  -1,  1,  -1,  1,  -1,  -1,  1,\n  1,  -1,  -1,  1,  1,  -1,  1,  1,  1,  1,  -1,  1,\n  -1,  -1,  -1,  -1,  -1,  1,  -1,  1,  1,  -1,  1,  -1\n]);\n\n// TODO - could be Uint8\n// prettier-ignore\nconst CUBE_NORMALS = new Float32Array([\n  // Front face\n  0,  0,  1,  0,  0,  1,  0,  0,  1,  0,  0,  1,\n  // Back face\n  0,  0,  -1,  0,  0,  -1,  0,  0,  -1,  0,  0,  -1,\n  // Top face\n  0,  1,  0,  0,  1,  0,  0,  1,  0,  0,  1,  0,\n  // Bottom face\n  0,  -1,  0,  0,  -1,  0,  0,  -1,  0,  0,  -1,  0,\n  // Right face\n  1,  0,  0,  1,  0,  0,  1,  0,  0,  1,  0,  0,\n  // Left face\n  -1,  0,  0,  -1,  0,  0,  -1,  0,  0,  -1,  0,  0\n]);\n\n// prettier-ignore\nconst CUBE_TEX_COORDS = new Float32Array([\n  // Front face\n  0,  0,  1,  0,  1,  1,  0,  1,\n  // Back face\n  1,  0,  1,  1,  0,  1,  0,  0,\n  // Top face\n  0,  1,  0,  0,  1,  0,  1,  1,\n  // Bottom face\n  1,  1,  0,  1,  0,  0,  1,  0,\n  // Right face\n  1,  0,  1,  1,  0,  1,  0,  0,\n  // Left face\n  0,  0,  1,  0,  1,  1,  0,  1\n]);\n\nconst ATTRIBUTES = {\n  POSITION: {size: 3, value: new Float32Array(CUBE_POSITIONS)},\n  NORMAL: {size: 3, value: new Float32Array(CUBE_NORMALS)},\n  TEXCOORD_0: {size: 2, value: new Float32Array(CUBE_TEX_COORDS)}\n};\n\nexport default class CubeGeometry extends Geometry {\n  constructor(props = {}) {\n    const {id = uid('cube-geometry')} = props;\n    super({\n      ...props,\n      id,\n      indices: {size: 1, value: new Uint16Array(CUBE_INDICES)},\n      attributes: {...ATTRIBUTES, ...props.attributes}\n    });\n  }\n}\n","import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport MathArray from './math-array';\nimport { checkNumber } from '../../lib/validators';\nimport assert from '../../lib/assert';\n\nvar Vector = function (_MathArray) {\n  _inherits(Vector, _MathArray);\n\n  function Vector() {\n    _classCallCheck(this, Vector);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Vector).apply(this, arguments));\n  }\n\n  _createClass(Vector, [{\n    key: \"len\",\n    value: function len() {\n      return Math.sqrt(this.lengthSquared());\n    }\n  }, {\n    key: \"magnitude\",\n    value: function magnitude() {\n      return this.len();\n    }\n  }, {\n    key: \"lengthSquared\",\n    value: function lengthSquared() {\n      var length = 0;\n\n      for (var i = 0; i < this.ELEMENTS; ++i) {\n        length += this[i] * this[i];\n      }\n\n      return length;\n    }\n  }, {\n    key: \"magnitudeSquared\",\n    value: function magnitudeSquared() {\n      return this.lengthSquared();\n    }\n  }, {\n    key: \"distance\",\n    value: function distance(mathArray) {\n      return Math.sqrt(this.distanceSquared(mathArray));\n    }\n  }, {\n    key: \"distanceSquared\",\n    value: function distanceSquared(mathArray) {\n      var length = 0;\n\n      for (var i = 0; i < this.ELEMENTS; ++i) {\n        var dist = this[i] - mathArray[i];\n        length += dist * dist;\n      }\n\n      return checkNumber(length);\n    }\n  }, {\n    key: \"dot\",\n    value: function dot(mathArray) {\n      var product = 0;\n\n      for (var i = 0; i < this.ELEMENTS; ++i) {\n        product += this[i] * mathArray[i];\n      }\n\n      return checkNumber(product);\n    }\n  }, {\n    key: \"normalize\",\n    value: function normalize() {\n      var length = this.magnitude();\n\n      if (length !== 0) {\n        for (var i = 0; i < this.ELEMENTS; ++i) {\n          this[i] /= length;\n        }\n      }\n\n      return this.check();\n    }\n  }, {\n    key: \"multiply\",\n    value: function multiply() {\n      for (var _len = arguments.length, vectors = new Array(_len), _key = 0; _key < _len; _key++) {\n        vectors[_key] = arguments[_key];\n      }\n\n      for (var _i = 0, _vectors = vectors; _i < _vectors.length; _i++) {\n        var vector = _vectors[_i];\n\n        for (var i = 0; i < this.ELEMENTS; ++i) {\n          this[i] *= vector[i];\n        }\n      }\n\n      return this.check();\n    }\n  }, {\n    key: \"divide\",\n    value: function divide() {\n      for (var _len2 = arguments.length, vectors = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        vectors[_key2] = arguments[_key2];\n      }\n\n      for (var _i2 = 0, _vectors2 = vectors; _i2 < _vectors2.length; _i2++) {\n        var vector = _vectors2[_i2];\n\n        for (var i = 0; i < this.ELEMENTS; ++i) {\n          this[i] /= vector[i];\n        }\n      }\n\n      return this.check();\n    }\n  }, {\n    key: \"lengthSq\",\n    value: function lengthSq() {\n      return this.lengthSquared();\n    }\n  }, {\n    key: \"distanceTo\",\n    value: function distanceTo(vector) {\n      return this.distance(vector);\n    }\n  }, {\n    key: \"distanceToSquared\",\n    value: function distanceToSquared(vector) {\n      return this.distanceSquared(vector);\n    }\n  }, {\n    key: \"getComponent\",\n    value: function getComponent(i) {\n      assert(i >= 0 && i < this.ELEMENTS, 'index is out of range');\n      return checkNumber(this[i]);\n    }\n  }, {\n    key: \"setComponent\",\n    value: function setComponent(i, value) {\n      assert(i >= 0 && i < this.ELEMENTS, 'index is out of range');\n      this[i] = value;\n      return this.check();\n    }\n  }, {\n    key: \"addVectors\",\n    value: function addVectors(a, b) {\n      return this.copy(a).add(b);\n    }\n  }, {\n    key: \"subVectors\",\n    value: function subVectors(a, b) {\n      return this.copy(a).subtract(b);\n    }\n  }, {\n    key: \"multiplyVectors\",\n    value: function multiplyVectors(a, b) {\n      return this.copy(a).multiply(b);\n    }\n  }, {\n    key: \"addScaledVector\",\n    value: function addScaledVector(a, b) {\n      return this.add(new this.constructor(a).multiplyScalar(b));\n    }\n  }, {\n    key: \"x\",\n    get: function get() {\n      return this[0];\n    },\n    set: function set(value) {\n      return this[0] = checkNumber(value);\n    }\n  }, {\n    key: \"y\",\n    get: function get() {\n      return this[1];\n    },\n    set: function set(value) {\n      return this[1] = checkNumber(value);\n    }\n  }]);\n\n  return Vector;\n}(MathArray);\n\nexport { Vector as default };","import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport Vector from './base/vector';\nimport { config, isArray } from '../lib/common';\nimport { checkNumber } from '../lib/validators';\nimport * as vec3 from 'gl-matrix/vec3';\nimport { vec3_transformMat2, vec3_transformMat4AsVector } from '../lib/gl-matrix-extras';\nvar ORIGIN = [0, 0, 0];\n\nvar Vector3 = function (_Vector) {\n  _inherits(Vector3, _Vector);\n\n  function Vector3() {\n    var _this;\n\n    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    _classCallCheck(this, Vector3);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Vector3).call(this, -0, -0, -0));\n\n    if (arguments.length === 1 && isArray(x)) {\n      _this.copy(x);\n    } else {\n      if (config.debug) {\n        checkNumber(x);\n        checkNumber(y);\n        checkNumber(z);\n      }\n\n      _this[0] = x;\n      _this[1] = y;\n      _this[2] = z;\n    }\n\n    return _this;\n  }\n\n  _createClass(Vector3, [{\n    key: \"set\",\n    value: function set(x, y, z) {\n      this[0] = x;\n      this[1] = y;\n      this[2] = z;\n      return this.check();\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(array) {\n      this[0] = array[0];\n      this[1] = array[1];\n      this[2] = array[2];\n      return this.check();\n    }\n  }, {\n    key: \"fromObject\",\n    value: function fromObject(object) {\n      if (config.debug) {\n        checkNumber(object.x);\n        checkNumber(object.y);\n        checkNumber(object.z);\n      }\n\n      this[0] = object.x;\n      this[1] = object.y;\n      this[2] = object.z;\n      return this.check();\n    }\n  }, {\n    key: \"toObject\",\n    value: function toObject(object) {\n      object.x = this[0];\n      object.y = this[1];\n      object.z = this[2];\n      return object;\n    }\n  }, {\n    key: \"angle\",\n    value: function angle(vector) {\n      return vec3.angle(this, vector);\n    }\n  }, {\n    key: \"cross\",\n    value: function cross(vector) {\n      vec3.cross(this, this, vector);\n      return this.check();\n    }\n  }, {\n    key: \"rotateX\",\n    value: function rotateX(_ref) {\n      var radians = _ref.radians,\n          _ref$origin = _ref.origin,\n          origin = _ref$origin === void 0 ? ORIGIN : _ref$origin;\n      vec3.rotateX(this, this, origin, radians);\n      return this.check();\n    }\n  }, {\n    key: \"rotateY\",\n    value: function rotateY(_ref2) {\n      var radians = _ref2.radians,\n          _ref2$origin = _ref2.origin,\n          origin = _ref2$origin === void 0 ? ORIGIN : _ref2$origin;\n      vec3.rotateY(this, this, origin, radians);\n      return this.check();\n    }\n  }, {\n    key: \"rotateZ\",\n    value: function rotateZ(_ref3) {\n      var radians = _ref3.radians,\n          _ref3$origin = _ref3.origin,\n          origin = _ref3$origin === void 0 ? ORIGIN : _ref3$origin;\n      vec3.rotateZ(this, this, origin, radians);\n      return this.check();\n    }\n  }, {\n    key: \"transform\",\n    value: function transform(matrix4) {\n      return this.transformAsPoint(matrix4);\n    }\n  }, {\n    key: \"transformAsPoint\",\n    value: function transformAsPoint(matrix4) {\n      vec3.transformMat4(this, this, matrix4);\n      return this.check();\n    }\n  }, {\n    key: \"transformAsVector\",\n    value: function transformAsVector(matrix4) {\n      vec3_transformMat4AsVector(this, this, matrix4);\n      return this.check();\n    }\n  }, {\n    key: \"transformByMatrix3\",\n    value: function transformByMatrix3(matrix3) {\n      vec3.transformMat3(this, this, matrix3);\n      return this.check();\n    }\n  }, {\n    key: \"transformByMatrix2\",\n    value: function transformByMatrix2(matrix2) {\n      vec3_transformMat2(this, this, matrix2);\n      return this.check();\n    }\n  }, {\n    key: \"transformByQuaternion\",\n    value: function transformByQuaternion(quaternion) {\n      vec3.transformQuat(this, this, quaternion);\n      return this.check();\n    }\n  }, {\n    key: \"ELEMENTS\",\n    get: function get() {\n      return 3;\n    }\n  }, {\n    key: \"z\",\n    get: function get() {\n      return this[2];\n    },\n    set: function set(value) {\n      return this[2] = checkNumber(value);\n    }\n  }]);\n\n  return Vector3;\n}(Vector);\n\nexport { Vector3 as default };","let channelHandles = 1;\nlet animationHandles = 1;\n\nexport class Timeline {\n  constructor() {\n    this.time = 0;\n    this.channels = new Map();\n    this.animations = new Map();\n    this.playing = false;\n    this.lastEngineTime = -1;\n  }\n\n  addChannel(props) {\n    const {delay = 0, duration = Number.POSITIVE_INFINITY, rate = 1, repeat = 1} = props;\n\n    const handle = channelHandles++;\n    const channel = {\n      time: 0,\n      delay,\n      duration,\n      rate,\n      repeat\n    };\n    this._setChannelTime(channel, this.time);\n    this.channels.set(handle, channel);\n\n    return handle;\n  }\n\n  removeChannel(handle) {\n    this.channels.delete(handle);\n\n    for (const [animationHandle, animation] of this.animations) {\n      if (animation.channel === handle) {\n        this.detachAnimation(animationHandle);\n      }\n    }\n  }\n\n  isFinished(handle) {\n    const channel = this.channels.get(handle);\n    if (channel === undefined) {\n      return false;\n    }\n\n    return this.time >= channel.delay + channel.duration * channel.repeat;\n  }\n\n  getTime(handle) {\n    if (handle === undefined) {\n      return this.time;\n    }\n\n    const channel = this.channels.get(handle);\n\n    if (channel === undefined) {\n      return -1;\n    }\n\n    return channel.time;\n  }\n\n  setTime(time) {\n    this.time = Math.max(0, time);\n\n    const channels = this.channels.values();\n    for (const channel of channels) {\n      this._setChannelTime(channel, this.time);\n    }\n\n    const animations = this.animations.values();\n    for (const animationData of animations) {\n      const {animation, channel} = animationData;\n      animation.setTime(this.getTime(channel));\n    }\n  }\n\n  play() {\n    this.playing = true;\n  }\n\n  pause() {\n    this.playing = false;\n    this.lastEngineTime = -1;\n  }\n\n  reset() {\n    this.setTime(0);\n  }\n\n  attachAnimation(animation, channelHandle) {\n    const animationHandle = animationHandles++;\n\n    this.animations.set(animationHandle, {\n      animation,\n      channel: channelHandle\n    });\n\n    animation.setTime(this.getTime(channelHandle));\n\n    return animationHandle;\n  }\n\n  detachAnimation(handle) {\n    this.animations.delete(handle);\n  }\n\n  update(engineTime) {\n    if (this.playing) {\n      if (this.lastEngineTime === -1) {\n        this.lastEngineTime = engineTime;\n      }\n      this.setTime(this.time + (engineTime - this.lastEngineTime));\n      this.lastEngineTime = engineTime;\n    }\n  }\n\n  _setChannelTime(channel, time) {\n    const offsetTime = time - channel.delay;\n    const totalDuration = channel.duration * channel.repeat;\n    // Note(Tarek): Don't loop on final repeat.\n    if (offsetTime >= totalDuration) {\n      channel.time = channel.duration * channel.rate;\n    } else {\n      channel.time = Math.max(0, offsetTime) % channel.duration;\n      channel.time *= channel.rate;\n    }\n  }\n}\n"],"sourceRoot":""}